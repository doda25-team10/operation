apiVersion: v1
kind: Secret
metadata:
  name: {{ include "myapp.appSecretName" . }}
  labels:
    {{- include "myapp.componentLabels" (dict "root" . "component" "app") | nindent 4 }}
type: Opaque
{{- $secretVals := dict "smtpUser" (.Values.app.secret.smtpUser | default "") "smtpPassword" (.Values.app.secret.smtpPassword | default "") }}
{{- if and (.Values.app.secret.autogenerate) (not (index $secretVals "smtpUser")) }}
  {{- $_ := set $secretVals "smtpUser" (printf "smtp-%s" (randAlphaNum 6)) }}
{{- end }}
{{- if and (.Values.app.secret.autogenerate) (not (index $secretVals "smtpPassword")) }}
  {{- $_ := set $secretVals "smtpPassword" (randAlphaNum 24) }}
{{- end }}
stringData:
  smtpUser: {{ default "CHANGE_ME" (index $secretVals "smtpUser") | quote }}
  smtpPassword: {{ default "CHANGE_ME" (index $secretVals "smtpPassword") | quote }}

